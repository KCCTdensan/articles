---
title: WSL爆速セットアップガイド
date: 2021-05-19
dateUpd: 2021-06-05
author: 山D
---

# WSL爆速セットアップガイド

2021年5月19日時点での最新情報です。
最新のバージョンのWindowsで使えるかは保証しません。

元気がある人は[本家の記事(日本語)](https://docs.microsoft.com/ja-jp/windows/wsl/install-win10)を読んで自分でセットアップしちゃうのもアリです。  
読んでて専門用語わからないよ〜〜となってしまった人もこのページを参考にするとよいかもしれません。

## 前提条件

- Windows10のバージョンが1903以降  
  → 最近のPCなら大丈夫ですが，もし不安なら`Win`キー+`Pause`キーでWindowsのバージョンを確認できます
- PCの管理者権限を持っている or 管理者のパスワードを知っている  
  → 自分用のPCであればまず心配しないで良いです

## Windowsのセットアップ

一般的なPCであれば，画面左下に4つ窓マークのスタートメニューがあります。
これは普段は左クリックして使うものですが，今回は右クリックします。
そうすると何かのメニューが出てきて，その中に`Windows PowerShell (管理者)`という項目が見つかるかと思います。これをクリックしてやりましょう。

そうするとなにやら青いウィンドウが立ち上がります。
これを使って，Windowsに必要な機能の設定をコマンド経由でやっちゃいます。
しかしコマンド操作とは言っても，やることはコピペだけです。ご安心ください。

まず，以下のコマンドをコピーします。
PowerShellのウィンドウではどこでも右クリックでコピーしたテキストを貼り付けることができます。

```
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
```

貼り付け終えたらEnterを押してコマンドを実行してください。エラーが出ずに終了すれば成功です。

次に，もう一度コマンドをコピペします。

```
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

ではEnterを押して実行しましょう。エラーは出ませんでしたか?

正常にコマンドが終了した場合はPowerShellのウィンドウを閉じてもらって結構です。
青い画面というものは精神衛生上あまりよろしくありませんね……。

では，ここまでいい感じに出来たのであれば**必ず**PCを一旦再起動させてください。
この再起動は**必須**の手順です。忘れてはいけません。

## Windowsのセットアップ(その2)

無事再起動を終えたPCは，この先の手順に進みます。

まず，「Linux カーネル更新プログラム パッケージ」をインストールします。
PCで[wsl_update_x64.msi](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)をダウンロードし，インストールしてください。
これは比較的すぐ終わります。

次に，もう一度PowerShellを開きます。(今回は管理者権限無くても大丈夫，スタートを右クリックして開くのが早い)
そこに，これをコピペ・実行します。

```
wsl --set-default-version 2
```

正常に実行できましたか?

## ディストロを選択・ダウンロード

何もわからないのであれば[Ubuntu](https://www.microsoft.com/store/productid/9NBLGGH4MSV6)が良いでしょう。  
MicrosoftStoreで検索・ダウンロードします。

## Ubuntuの初期設定

さっきの手順でUbuntu以外を選んだ人は雰囲気で頑張ってください。

### 起動

アプリ一覧のとこからUbuntuってやつを探して起動してください。

なにやら初期設定のような画面が出てくるのですが，

- ユーザー名は半角の英小文字or数字しか使えない
- パスワードは入力欄に反映されないが，しっかり入力されている

ということに留意して完了してください。

### sudoersの編集

`sudo`というコマンドはセキュリティ云々のアレで使う時にいちいちパスワードを聞いてくるのですが，これは自分だけが使用するシステムなのでパスワード入力を省略する設定にしちゃいます。  

ではまずUbuntuのウィンドウに次のコマンドを入力して実行します。

```bash
sudo visudo
```

ここでUbuntuの初回起動時に設定したパスワードを聞かれるのですが，いくら入力しても文字が入力されたような気配はありません。
しかしこれは正常で，実はちゃんと入力できているので普通に入力してEnterを押してください。

成功するとなにやらテキストエディタのようなものが立ち上がるのですが，

```
%sudo   ALL=(ALL:ALL) ALL
```

の行を

```
%sudo   ALL=(ALL:ALL) NOPASSWD: ALL
```

と書き変えてやってください。

1. `Ctrl`+`x`
1. `y`
1. `Enter`
と順に入力していくと，ここでの変更を保存して終了できます。

## システムの更新

これで一応使い物になるUbuntuのシステムが出来上がったのですが，最後にシステムの更新だけやっておきます。
次のコマンドを実行してください。

```
sudo apt update
sudo apt full-upgrade -y
sudo apt autoremove -y
```

## お便利設定

Ubuntuで以下のコマンドを実行してください。
`ll`と`la`コマンドの追加と，UbuntuのホームディレクトリにWindowsのホームディレクトリのsymlinkを貼ります。

```bash
ln -sf /mnt/c/Users/$(cmd.exe /c "SET /P X=%USERNAME%<NUL" 2>/dev/null) WinHome
echo 'alias ll="ls -l"; alias la="ls -Al"' >> ~/.bashrc
. ~/{.bashrc,.profile}
```

## 終わりに

いかがでしたでしょうか。

Ubuntuは有名な割にけっこうクセが強いディストロなので，暇があるなら他のディストロも触ってみることをおすすめします。
